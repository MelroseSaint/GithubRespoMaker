<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RespoGen — User Guide</title>
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/guide.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="header-left">
      <h1>RespoGen</h1>
    </div>
    <nav class="header-right">
      <div class="dropdown">
        <button class="dropdown-toggle">Guide ▾</button>
        <div class="dropdown-menu">
          <a href="/guide.html#quick-start">Quick Start</a>
          <a href="/guide.html#using-the-web-ui">Web UI</a>
          <a href="/guide.html#using-the-api">API Usage</a>
          <a href="/guide.html#templates">Templates</a>
          <a href="/guide.html#advanced-configuration-details">Advanced Options</a>
          <a href="/guide.html#troubleshooting">Troubleshooting</a>
          <a href="/guide.html#support">Support</a>
        </div>
      </div>
      <a class="nav-link" href="/">Home</a>
    </nav>
  </header>
  <main class="guide-layout">
    <aside class="guide-toc">
      <h2>On this page</h2>
      <nav id="toc"></nav>
    </aside>
    <article id="guide-content" class="guide-content"></article>
  </main>

  <footer>
    <small>RespoGen Docs</small>
  </footer>

  <!-- Markdown renderer and sanitizer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.5/dist/purify.min.js"></script>
  <script>
    // Fetch markdown, render to HTML, add anchors, and build TOC
    async function renderGuide() {
      const res = await fetch('/docs/UserGuide.md');
      const md = await res.text();
      const html = marked.parse(md, { headerIds: false });
      const clean = DOMPurify.sanitize(html);
      const container = document.getElementById('guide-content');
      container.innerHTML = clean;

      // Generate slug for headings
      const slugify = str => str.toLowerCase().trim()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-');

      // Add ids to headings and collect for TOC
      const headings = container.querySelectorAll('h1, h2, h3');
      const toc = document.getElementById('toc');
      const currentHash = decodeURIComponent(location.hash.replace('#',''));
      headings.forEach(h => {
        const id = slugify(h.textContent);
        h.id = id;
        const a = document.createElement('a');
        a.href = `#${id}`;
        a.textContent = h.textContent;
        a.className = `toc-link level-${h.tagName.toLowerCase()}`;
        toc.appendChild(a);
      });

      // Smooth scroll for in-page links
      document.querySelectorAll('a[href^="#"]').forEach(a => {
        a.addEventListener('click', e => {
          const targetId = a.getAttribute('href').slice(1);
          const el = document.getElementById(targetId);
          if (el) {
            e.preventDefault();
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
            history.replaceState(null, '', `#${targetId}`);
          }
        });
      });

      // If hash present, scroll to it
      if (currentHash) {
        const el = document.getElementById(currentHash);
        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    renderGuide();

    // Dropdown behavior
    (function initDropdown(){
      const toggle = document.querySelector('.dropdown-toggle');
      const menu = document.querySelector('.dropdown-menu');
      toggle.addEventListener('click', (e) => {
        e.stopPropagation();
        menu.classList.toggle('open');
      });
      document.addEventListener('click', () => menu.classList.remove('open'));
      menu.querySelectorAll('a').forEach(a => a.addEventListener('click', () => menu.classList.remove('open')));
    })();
  </script>
</body>
</html>
